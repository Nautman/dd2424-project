For this freeze function:

# unfrozen_layers are the number of layers that are unfrozen
def get_model_frozen_until(unfrozen_layers, model_name):
    model = get_model(model_name)
    children = list(model.children())
    params_lr = []

    for child in children[:-unfrozen_layers]:
        for param in child.parameters():
            param.requires_grad = False

    lr = 10**(-unfrozen_layers)

    for child in children[-unfrozen_layers:]:
        params_lr.append({'params': child.parameters(), 'lr': lr})
        lr *= 10
        
    return model, params_lr


Linear(in_features=2048, out_features=1000, bias=True)
training model with 1 unfrozen layers
Epoch 0/9
----------
phase: train
train Loss: 9.3116 Acc: 0.6378
phase: val
val Loss: 3.7448 Acc: 0.8057
epoch took: 22.773900985717773
Epoch 1/9
----------
phase: train
train Loss: 2.3671 Acc: 0.8800
phase: val
val Loss: 3.3219 Acc: 0.8587
epoch took: 23.103203773498535
Epoch 2/9
----------
phase: train
train Loss: 1.1385 Acc: 0.9290
phase: val
val Loss: 4.6778 Acc: 0.8261
epoch took: 20.8163640499115
Epoch 3/9
----------
phase: train
train Loss: 1.3011 Acc: 0.9305
phase: val
val Loss: 6.7712 Acc: 0.8247
epoch took: 21.230154514312744
Epoch 4/9
----------
phase: train
train Loss: 1.7479 Acc: 0.9266
phase: val
val Loss: 5.7393 Acc: 0.8546
epoch took: 20.845492124557495
Epoch 5/9
----------
phase: train
train Loss: 1.0176 Acc: 0.9491
phase: val
val Loss: 5.2934 Acc: 0.8723
epoch took: 22.79678463935852
Epoch 6/9
----------
phase: train
train Loss: 0.6824 Acc: 0.9627
phase: val
val Loss: 6.1307 Acc: 0.8560
epoch took: 21.137148141860962
Epoch 7/9
----------
phase: train
train Loss: 0.5934 Acc: 0.9666
phase: val
val Loss: 6.6525 Acc: 0.8655
epoch took: 20.57356357574463
Epoch 8/9
----------
phase: train
train Loss: 0.8056 Acc: 0.9647
phase: val
val Loss: 6.0292 Acc: 0.8614
epoch took: 20.73195457458496
Epoch 9/9
----------
phase: train
train Loss: 1.0817 Acc: 0.9573
phase: val
val Loss: 6.6696 Acc: 0.8451
epoch took: 21.003074645996094
Training complete in 3m 37s
Best val Acc: 0.872283
Linear(in_features=2048, out_features=1000, bias=True)
training model with 2 unfrozen layers
Epoch 0/9
----------
phase: train
train Loss: 10.4284 Acc: 0.6277
phase: val
val Loss: 3.1944 Acc: 0.8438
epoch took: 22.04528021812439
Epoch 1/9
----------
phase: train
train Loss: 1.6506 Acc: 0.9057
phase: val
val Loss: 3.6125 Acc: 0.8329
epoch took: 20.47642493247986
Epoch 2/9
----------
phase: train
train Loss: 1.3814 Acc: 0.9169
phase: val
val Loss: 3.5814 Acc: 0.8451
epoch took: 22.49121856689453
Epoch 3/9
----------
phase: train
train Loss: 1.1218 Acc: 0.9371
phase: val
val Loss: 4.4162 Acc: 0.8505
epoch took: 21.474987030029297
Epoch 4/9
----------
phase: train
train Loss: 1.1970 Acc: 0.9391
phase: val
val Loss: 4.0256 Acc: 0.8601
epoch took: 21.893616676330566
Epoch 5/9
----------
phase: train
train Loss: 1.0560 Acc: 0.9523
phase: val
val Loss: 3.4705 Acc: 0.8764
epoch took: 21.897614240646362
Epoch 6/9
----------
phase: train
train Loss: 0.8613 Acc: 0.9604
phase: val
val Loss: 4.0737 Acc: 0.8791
epoch took: 22.024621963500977
Epoch 7/9
----------
phase: train
train Loss: 1.0108 Acc: 0.9569
phase: val
val Loss: 4.2302 Acc: 0.8641
epoch took: 20.85634469985962
Epoch 8/9
----------
phase: train
train Loss: 0.9750 Acc: 0.9620
phase: val
val Loss: 5.1837 Acc: 0.8668
epoch took: 20.87423038482666
Epoch 9/9
----------
phase: train
train Loss: 0.5249 Acc: 0.9744
phase: val
val Loss: 5.0174 Acc: 0.8750
epoch took: 21.08349847793579
Training complete in 3m 37s
Best val Acc: 0.879076
Linear(in_features=2048, out_features=1000, bias=True)
training model with 3 unfrozen layers
Epoch 0/9
----------
phase: train
train Loss: 8.8742 Acc: 0.6374
phase: val
val Loss: 3.1507 Acc: 0.8234
epoch took: 23.290261268615723
Epoch 1/9
----------
phase: train
train Loss: 2.7205 Acc: 0.8719
phase: val
val Loss: 4.5626 Acc: 0.8288
epoch took: 23.080485820770264
Epoch 2/9
----------
phase: train
train Loss: 1.4932 Acc: 0.9243
phase: val
val Loss: 3.5800 Acc: 0.8587
epoch took: 23.060394525527954
Epoch 3/9
----------
phase: train
train Loss: 1.1836 Acc: 0.9356
phase: val
val Loss: 4.4606 Acc: 0.8614
epoch took: 23.21213984489441
Epoch 4/9
----------
phase: train
train Loss: 0.7847 Acc: 0.9554
phase: val
val Loss: 4.8203 Acc: 0.8519
epoch took: 20.648983240127563
Epoch 5/9
----------
phase: train
train Loss: 1.2705 Acc: 0.9445
phase: val
val Loss: 5.0353 Acc: 0.8560
epoch took: 21.246493101119995
Epoch 6/9
----------
phase: train
train Loss: 0.6035 Acc: 0.9686
phase: val
val Loss: 5.3878 Acc: 0.8601
epoch took: 20.939653158187866
Epoch 7/9
----------
phase: train
train Loss: 1.0584 Acc: 0.9503
phase: val
val Loss: 5.1049 Acc: 0.8641
epoch took: 22.277554750442505
Epoch 8/9
----------
phase: train
train Loss: 0.8805 Acc: 0.9643
phase: val
val Loss: 6.9849 Acc: 0.8424
epoch took: 20.738951444625854
Epoch 9/9
----------
phase: train
train Loss: 0.8801 Acc: 0.9651
phase: val
val Loss: 5.2772 Acc: 0.8696
epoch took: 22.339274406433105
Training complete in 3m 43s
Best val Acc: 0.869565
Linear(in_features=2048, out_features=1000, bias=True)
training model with 4 unfrozen layers
Epoch 0/9
----------
phase: train
train Loss: 8.7179 Acc: 0.6351
phase: val
val Loss: 3.6523 Acc: 0.8220
epoch took: 21.87443494796753
Epoch 1/9
----------
phase: train
train Loss: 1.8532 Acc: 0.8851
phase: val
val Loss: 4.5138 Acc: 0.8234
epoch took: 22.949304819107056
Epoch 2/9
----------
phase: train
train Loss: 1.5923 Acc: 0.9107
phase: val
val Loss: 4.6080 Acc: 0.8560
epoch took: 22.108304738998413
Epoch 3/9
----------
phase: train
train Loss: 1.3583 Acc: 0.9325
phase: val
val Loss: 5.3296 Acc: 0.8247
epoch took: 20.980931043624878
Epoch 4/9
----------
phase: train
train Loss: 1.4901 Acc: 0.9383
phase: val
val Loss: 4.3761 Acc: 0.8641
epoch took: 22.378498315811157
Epoch 5/9
----------
phase: train
train Loss: 0.8051 Acc: 0.9569
phase: val
val Loss: 4.1626 Acc: 0.8641
epoch took: 20.593350410461426
Epoch 6/9
----------
phase: train
train Loss: 0.5768 Acc: 0.9670
phase: val
val Loss: 4.8320 Acc: 0.8696
epoch took: 22.192163944244385
Epoch 7/9
----------
phase: train
train Loss: 1.0052 Acc: 0.9530
phase: val
val Loss: 5.5350 Acc: 0.8628
epoch took: 20.512343168258667
Epoch 8/9
----------
phase: train
train Loss: 0.9397 Acc: 0.9573
phase: val
val Loss: 5.9476 Acc: 0.8478
epoch took: 20.175909280776978
Epoch 9/9
----------
phase: train
train Loss: 0.8508 Acc: 0.9612
phase: val
val Loss: 5.7697 Acc: 0.8723
epoch took: 22.226322412490845
Training complete in 3m 38s
Best val Acc: 0.872283
Linear(in_features=2048, out_features=1000, bias=True)
training model with 5 unfrozen layers
Epoch 0/9
----------
phase: train
train Loss: 8.1545 Acc: 0.6479
phase: val
val Loss: 2.4734 Acc: 0.8723
epoch took: 22.25467801094055
Epoch 1/9
----------
phase: train
train Loss: 1.9561 Acc: 0.8964
phase: val
val Loss: 3.9768 Acc: 0.8288
epoch took: 20.182188510894775
Epoch 2/9
----------
phase: train
train Loss: 1.7423 Acc: 0.9026
phase: val
val Loss: 4.1001 Acc: 0.8315
epoch took: 20.635812282562256
Epoch 3/9
----------
phase: train
train Loss: 1.5017 Acc: 0.9200
phase: val
val Loss: 4.0597 Acc: 0.8750
epoch took: 22.00165295600891
Epoch 4/9
----------
phase: train
train Loss: 0.9434 Acc: 0.9511
phase: val
val Loss: 4.9775 Acc: 0.8492
epoch took: 20.225345134735107
Epoch 5/9
----------
phase: train
train Loss: 0.7687 Acc: 0.9589
phase: val
val Loss: 6.2620 Acc: 0.8478
epoch took: 22.809119701385498
Epoch 6/9
----------
phase: train
train Loss: 0.9044 Acc: 0.9569
phase: val
val Loss: 4.4805 Acc: 0.8750
epoch took: 20.217803955078125
Epoch 7/9
----------
phase: train
train Loss: 1.1323 Acc: 0.9546
phase: val
val Loss: 4.5399 Acc: 0.8736
epoch took: 20.19156289100647
Epoch 8/9
----------
phase: train
train Loss: 0.8511 Acc: 0.9635
phase: val
val Loss: 5.9017 Acc: 0.8546
epoch took: 20.321277141571045
Epoch 9/9
----------
phase: train
train Loss: 1.0082 Acc: 0.9674
phase: val
val Loss: 6.9952 Acc: 0.8274
epoch took: 20.030427932739258
Training complete in 3m 31s
Best val Acc: 0.875000
Accuracy for best config combination: tensor(0.8791, device='cuda:0')
Weights path for best combination ./model_name:resnet101;crop:False;random_flip:False;rotate_angle:0;random_resized_crop:False;device:cudaunfrozen:2.pt